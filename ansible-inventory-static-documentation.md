# Ansible Static Inventory Documentation

---

| Created By      | Created on   | Version | Last updated by   | Pre Reviewer   | L0 Reviewer | L1 Reviewer | L2 Reviewer |
|-----------------|--------------|---------|-------------------|----------------|-------------|-------------|-------------|
| Ashutosh Kumar  | 2025-07-19   | 1.0     | Ashutosh Kumar    |                |             |             |             |

---

## Table of Contents

1. [Overview](#overview)
2. [What is Ansible Inventory?](#what-is-ansible-inventory)
3. [Why Use a Static Inventory?](#why-use-a-static-inventory)
4. [Precedence and Inventory Selection](#precedence-and-inventory-selection)
5. [Static Inventory File Structure](#static-inventory-file-structure)
6. [How to Define Hosts and Groups](#how-to-define-hosts-and-groups)
7. [Host and Group Variables](#host-and-group-variables)
8. [Required Settings for Static Inventory](#required-settings-for-static-inventory)
9. [Sample Static Inventory Files](#sample-static-inventory-files)
10. [Best Practices](#best-practices)
11. [Verification and Usage](#verification-and-usage)
12. [Troubleshooting](#troubleshooting)
13. [References](#references)
14. [Contact Information](#contact-information)

---

## Overview

A static inventory in Ansible is a file that lists all managed servers (hosts), organizes them into groups as needed, and specifies any additional settings required for automation. The static inventory is essential for defining the infrastructure Ansible should manage, and is typically written in INI or YAML format.

---

## What is Ansible Inventory?

Ansible inventory is a source of information about the hosts and groups that Ansible manages. It tells Ansible which machines to communicate with, how they are grouped, and what variables may be associated with them. Inventories can be static (fixed files) or dynamic (generated by scripts or plugins).

- **Official Reference:** [Ansible Inventory - Official Docs](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html)

---

## Why Use a Static Inventory?

- **Simplicity:** Straightforward to configure and maintain for small to medium environments.
- **Reproducibility:** Inventory files can be version-controlled, reviewed, and shared.
- **Explicitness:** All hosts, groups, and settings are clearly defined in a single file.
- **Immediate Feedback:** Works seamlessly with Ansible commands for ad-hoc tasks, playbooks, and testing.

---

## Precedence and Inventory Selection

When running Ansible commands, the static inventory file is used based on the following precedence (official [docs](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#default-inventory-file-location)):

1. **Command-Line Option (`-i`)**:  
   The inventory file specified with the `-i` option takes highest precedence.
   ```bash
   ansible-playbook -i inventory.ini playbook.yml
   ```

2. **Environment Variable (`ANSIBLE_INVENTORY`)**:  
   If set, Ansible uses the inventory file or script defined in this variable.

3. **Default Location**:  
   If neither of the above is set, Ansible uses the default `hosts` file at `/etc/ansible/hosts`.

**Note:**  
If you specify both a static and a dynamic inventory, the one with higher precedence (based on above rules) will be used. If group or host variables are defined in multiple inventories, values from the higher precedence inventory take effect.

---

## Static Inventory File Structure

A static inventory can be written in two main formats:

- **INI (default):** Simple, widely used, easy to read.
- **YAML:** More structured, supports advanced features.

### INI Example Structure

```ini
[webservers]
web1.example.com
web2.example.com

[dbservers]
db1.example.com ansible_user=dbadmin
db2.example.com ansible_host=192.168.1.10 ansible_port=2222

[all:vars]
ansible_ssh_private_key_file=/home/ansible/.ssh/id_rsa
```

### YAML Example Structure

```yaml
all:
  hosts:
    web1.example.com:
    web2.example.com:
    db1.example.com:
      ansible_user: dbadmin
    db2.example.com:
      ansible_host: 192.168.1.10
      ansible_port: 2222
  vars:
    ansible_ssh_private_key_file: /home/ansible/.ssh/id_rsa
  children:
    webservers:
      hosts:
        web1.example.com:
        web2.example.com:
    dbservers:
      hosts:
        db1.example.com:
        db2.example.com:
```

---

## How to Define Hosts and Groups

- **Hosts:** Specify hostnames or IP addresses directly under a group.
- **Groups:** Use group sections (INI) or keys (YAML) to organize hosts by function, environment, or location.
- **Children Groups:** Organize groups within groups for hierarchical environments.

---

## Host and Group Variables

- **Host Variables:** Apply only to a specific host (e.g., `ansible_user`, `ansible_host`, `ansible_port`).
- **Group Variables:** Apply to all hosts within a group, declared under `[group:vars]` (INI) or `vars:` in YAML.

**Examples:**

```ini
[webservers]
web1 ansible_user=admin

[webservers:vars]
http_port=80
```

```yaml
webservers:
  hosts:
    web1:
      ansible_user: admin
  vars:
    http_port: 80
```

---

## Required Settings for Static Inventory

To ensure your static inventory works properly with Ansible commands, include these key settings as needed:

- **Correct hostnames or IPs:** Ensure all entries resolve and are reachable.
- **User and authentication:**  
  - Use `ansible_user` to specify the SSH user.
  - Use `ansible_ssh_private_key_file` for key-based authentication.
  - Use `ansible_password` if password authentication is needed (not recommended for production).
- **SSH Port:**  
  If a host uses a non-standard SSH port, set `ansible_port` accordingly.
- **Host aliasing:**  
  Use `ansible_host` to define the actual connection address if different from the inventory name.
- **Variables:**  
  Define global, group, or host-specific variables as required for your playbooks and roles.
- **Connection type:**  
  For non-SSH protocols, set `ansible_connection` (e.g., `local`, `winrm`).

Example:
```ini
[app]
app1 ansible_host=192.168.10.23 ansible_user=ubuntu ansible_port=2222 ansible_ssh_private_key_file=~/.ssh/id_rsa

[all:vars]
ansible_python_interpreter=/usr/bin/python3
```

---

## Sample Static Inventory Files

### Minimal INI Example

```ini
server1.example.com
server2.example.com
```

### Grouped INI Example

```ini
[frontend]
frontend1 ansible_host=10.0.0.1
frontend2 ansible_host=10.0.0.2

[backend]
backend1 ansible_host=10.0.1.1
backend2 ansible_host=10.0.1.2
```

### YAML Example with Variables

```yaml
all:
  hosts:
    server1:
    server2:
  vars:
    ansible_connection: ssh
    ansible_user: deployer
```

---

## Best Practices

- Use meaningful group and host names.
- Organize hosts into logical groups (e.g., by role or environment).
- Store sensitive data using Ansible Vault, not directly in the inventory.
- Use YAML format for complex inventories.
- Keep inventory files under version control.
- Test inventory connectivity with `ansible all -m ping -i inventory_file`.

---

## Verification and Usage

- **Check Inventory:**  
  ```bash
  ansible-inventory -i inventory.ini --list
  ansible-inventory -i inventory.yaml --graph
  ```

- **Run Ansible Commands:**  
  ```bash
  ansible all -i inventory.ini -m ping
  ansible-playbook -i inventory.yaml playbook.yml
  ```

---

## Troubleshooting

| Issue                   | Solution                                                           |
|-------------------------|--------------------------------------------------------------------|
| Unknown host/group      | Verify spelling and structure in inventory file.                   |
| Connection failure      | Check `ansible_user`, `ansible_host`, `ansible_port`, SSH key.     |
| Variable not applied    | Ensure variable scope (host/group/all) is correct.                 |
| Inventory not found     | Specify inventory file with `-i` flag and check file permissions.  |

---

## References

| Link                                                                                                 | Description                                 |
|------------------------------------------------------------------------------------------------------|---------------------------------------------|
| [Ansible Inventory Guide](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html) | Official inventory documentation           |
| [Static Inventory (INI)](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#ini) | INI inventory examples                     |
| [Static Inventory (YAML)](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#yaml) | YAML inventory examples                    |
| [Inventory precedence](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html#inventory-precedence) | Official precedence documentation          |

---

## Contact Information

| Name            | Email Address                         |
|-----------------|--------------------------------------|
| Ashutosh Kumar  | ashutosh.kumar.snaatak@mygurukulam.co|

---